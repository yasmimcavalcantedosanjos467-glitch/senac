<!-- FILE: index.html -->
<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Metas Diárias</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <main class="app">
    <header class="app-header">
      <h1>Metas Diárias</h1>
      <p class="subtitle">Organize seu dia — simples, rápido e persistente.</p>
    </header>

    <section class="form-section">
      <form id="task-form">
        <input id="task-input" type="text" placeholder="O que você quer fazer hoje?" required maxlength="120">
        <input id="task-date" type="date">
        <select id="task-priority" aria-label="Prioridade">
          <option value="low">Baixa</option>
          <option value="medium" selected>Média</option>
          <option value="high">Alta</option>
        </select>
        <button type="submit" class="btn-add">Adicionar</button>
      </form>

      <div class="controls">
        <div class="filters">
          <button class="filter active" data-filter="all">Todas</button>
          <button class="filter" data-filter="today">Hoje</button>
          <button class="filter" data-filter="pending">Pendentes</button>
          <button class="filter" data-filter="done">Concluídas</button>
        </div>
        <div class="actions">
          <button id="clear-completed">Limpar concluídas</button>
          <button id="clear-all">Limpar tudo</button>
        </div>
      </div>
    </section>

    <section class="list-section">
      <ul id="tasks-list" class="tasks"></ul>
      <p id="empty-msg" class="empty">Nenhuma meta — adicione a primeira acima!</p>
    </section>

    <footer class="app-footer">
      <small>Dicas: clique na tarefa para marcar como feita. Clique em editar para alterar.</small>
    </footer>
  </main>

  <script src="script.js" defer></script>
</body>
</html>



function clearAll(){
  if(!confirm('Tem certeza que quer apagar todas as metas?')) return;
  tasks=[]; save(); render();
}

function formatDate(d){
  if(!d) return '';
  const dt = new Date(d + 'T00:00:00');
  return dt.toLocaleDateString('pt-BR');
}

function render(){
  listEl.innerHTML = '';
  const filtered = tasks.filter(t=>{
    if(currentFilter==='all') return true;
    if(currentFilter==='today'){
      const today = new Date().toISOString().slice(0,10);
      return t.date === today;
    }
    if(currentFilter==='pending') return !t.done;
    if(currentFilter==='done') return t.done;
    return true;
  });

  if(filtered.length===0){
    emptyMsg.style.display = 'block';
  } else {
    emptyMsg.style.display = 'none';
  }

  filtered.forEach(t=>{
    const li = document.createElement('li');
    li.className = 'task-item';

    const checkbox = document.createElement('div');
    checkbox.className = 'checkbox' + (t.done? ' checked' : '');
    checkbox.title = t.done ? 'Marcar como pendente' : 'Marcar como concluída';
    checkbox.addEventListener('click', ()=> toggleDone(t.id));

    if(t.done){
      checkbox.innerHTML = '\u2713'; // checkmark
    }

    const content = document.createElement('div');
    content.className = 'task-content';

    const title = document.createElement('div');
    title.className = 'task-title';
    title.textContent = t.title;
    if(t.done) title.style.textDecoration = 'line-through';

    const meta = document.createElement('div');
    meta.className = 'task-meta';
    meta.innerHTML = `${t.date ? formatDate(t.date) : 'Sem data'} • <span class="priority-${t.priority}">${t.priority}</span>`;

    content.appendChild(title);
    content.appendChild(meta);

    const actions = document.createElement('div');
    actions.className = 'task-actions';

    const editBtn = document.createElement('button');
    editBtn.textContent = 'Editar';
    editBtn.addEventListener('click', ()=> editTask(t.id));

    const delBtn = document.createElement('button');
    delBtn.textContent = 'Apagar';
    delBtn.addEventListener('click', ()=>{ if(confirm('Apagar esta meta?')) deleteTask(t.id); });

    actions.appendChild(editBtn);
    actions.appendChild(delBtn);

    li.appendChild(checkbox);
    li.appendChild(content);
    li.appendChild(actions);

    listEl.appendChild(li);
  });
}

form.addEventListener('submit', e=>{
  e.preventDefault();
  const title = input.value.trim();
  if(!title) return;
  const date = dateInput.value || '';
  const priority = prioritySelect.value || 'medium';
  addTask(title, date, priority);
  form.reset();
  // reset date to today again
  const today = new Date().toISOString().slice(0,10);
  dateInput.value = today;
  input.focus();
});

filters.forEach(btn=> btn.addEventListener('click', ()=>{
  filters.forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  currentFilter = btn.dataset.filter;
  render();
}));

clearCompletedBtn.addEventListener('click', ()=>{
  if(confirm('Remover todas as metas concluídas?')) clearCompleted();
});
clearAllBtn.addEventListener('click', ()=> clearAll());

// initial
load(); render();

// expose for debugging (opcional)
window._dailyGoals = {tasks, save, load, render};
